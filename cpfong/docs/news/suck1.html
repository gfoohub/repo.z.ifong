<html><head><meta HTTP-EQUIV="content-type" CONTENT="text/html; charset=UTF-8"><title>Google Search: suck group:tw.bbs.* </title><style><!--
body,td,div,.p,a{font-family: }
div{line-height:120%}
div,td{color:#000}
.f,.fl:link{color:#6f6f6f}
a:link,.w,a.w:link,.w a:link{color:#00c}
a:visited,.fl:visited{color:#551a8b}
a:active,.fl:active{color:#f00}
.t a:link,.t a:active,.t a:visited,.t{color:#000000}
.t{background-color:#ffcc33}
.h{color:#ddaa11;font-size:14px}
.i,.i:link{color:#a90a08}
.a,.a:link{color:#008000}
.z{display:none}
div.n {margin-top: 1ex}
.n a{font-size:10pt; color:#000}
.n .i{font-size:10pt; font-weight:bold}
.q a:visited,.q a:link,.q a:active,.q {text-decoration: none; color: #00c;}
.b{font-size: 12pt; color:#00c; font-weight:bold}
.ch{cursor:pointer;cursor:hand}
//-->
</style>
<script>
<!--
function ss(w){window.status=w;return true;}
function cs(){window.status='';}
//-->
</script>
<script>
<!--
function ga(o,e){if (document.getElementById){a=o.id.substring(1); p = "";r = "";g = e.target;if (g) { t = g.id;f = g.parentNode;if (f) {p = f.id;h = f.parentNode;if (h) r = h.id;}} else{h = e.srcElement;f = h.parentNode;if (f) p = f.id;t = h.id;}if (t==a || p==a || r==a) return true;location.href=document.getElementById(a).href}}
//-->
</script>
</head><body bgcolor=#ffffff onLoad="document.gs.reset()"><table border=0 cellpadding=0 cellspacing=0><tr><td rowspan=3 valign=top><table cellpadding=0 cellspacing=0 border=0><tr><td align=right valign=bottom><a href=http://groups.google.com><img src=/images/res0.gif alt="Go to Google Groups Home" border=0 width=110 height=58></a></td><td valign=bottom><a href=http://groups.google.com><img src=/images/res1.gif border=0 width=38 height=58 alt=""></a></td><td valign=bottom><a href=http://groups.google.com><img src=/images/res2.gif border=0 width=52 height=58 alt=""></a></td></tr><tr><td align=right valign=top class=h><b>Groups</b></td><td valign=top><a href=http://groups.google.com><img src=/images/res3.gif border=0 width=38 height=20 alt=""></a></td><td valign=top><font color=#6f6f6f style=font-size:14px>&nbsp;</font></td></tr></table></td><td nowrap><font size=-1><a href=/advanced_group_search?q=suck+group:tw.bbs.*&hl=en&lr=lang_zh-TW&ie=UTF-8&oe=UTF-8>Advanced&nbsp;Groups&nbsp;Search</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href=/preferences?q=suck+group:tw.bbs.*&hl=en&lr=lang_zh-TW&ie=UTF-8&oe=UTF-8>Preferences</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href=/googlegroups/help.html>Groups Help</a>&nbsp;</font></td></tr><tr><td valign=middle><form name=gs method=GET action=/groups><input type=hidden name=hl value="en"><input type=hidden name=lr value="lang_zh-TW"><input type=hidden name=ie value="UTF-8"><input type=hidden name=oe value="UTF-8"><input type=text name=q size=31 maxlength=2048 value="suck group:tw.bbs.*"><font size=-1> <input type=submit name="btnG" value="Google Search"><span id=hf></span></font></td></tr><tr><td><font size=-1>&nbsp;</font></td></tr></form></table><table width=100% border=0 cellpadding=1 cellspacing=0 bgcolor=#ffcc33><tr><td bgcolor=#ffcc33 nowrap><table width=100% border=0 cellpadding=1 cellspacing=0 bgcolor=#ffcc33><tr><td bgcolor=#ffcc33 nowrap><font size=-1 color=#000000><b>Groups search result 1</b> for <b>suck group:tw.bbs.*</b>&nbsp; </font></td></tr></table></td></tr></table><br clear=all>
<table width=100% bgcolor=#e0e0e0 cellpadding=2 cellspacing=0 border=0><tr><td><font face=arial,sans-serif>

<table cellpadding=0 cellspacing=0 border=0 align=right><tr><td><font face=arial,sans-serif>Search Result 1</font></td></tr></table>
From: <a href=/groups?hl=en&lr=lang_zh-TW&ie=UTF-8&oe=UTF-8&q=author:netmanforever%40yahoo.com+ >網中人</a> (<a href=mailto:netmanforever%40yahoo.com>netmanforever@yahoo.com</a>)<br>Subject: [ 技術分享 ] 關於主動 NEWS 抓取 (<B style="color:black;background-color:#ffff66">suck</B>) <br><font face=arial,sans-serif><table cellpadding=0 cellspacing=0 border=0 align=right><tr><td> This is the only article in this thread </td></tr><tr><td align=right> View: <a href=/groups?selm=8p5jas%24985%40netnews.hinet.net&oe=UTF-8&output=gplain >Original Format</a></td></tr></table></font>
Newsgroups: <a href=/groups?hl=en&lr=lang_zh-TW&ie=UTF-8&oe=UTF-8&group=tw.bbs.comp.linux >tw.bbs.comp.linux</a><br>Date: 2000-09-06 07:10:35 PST
<br></font></td></tr></table><pre>2000/09/06
 前一次更新 NEWS 伺服器文章的時候﹐曾說過如果一旦解決了主動抓信的方法﹐一定
會和大家分享的。網中人絕不食言﹐現在已經把設定 <B style="color:black;background-color:#ffff66">suck</B> 的步驟寫出來了。希望可以
供大家參考一下﹐能大家共同研究研究就更好了。

<a href="http://pds.nchu.edu.tw/study_area/linux/linux_news.htm">http://pds.nchu.edu.tw/study_area/linux/linux_news.htm</a>


設定 <B style="color:black;background-color:#ffff66">suck</B>

好了﹐前面說的餵信方式﹐要經過雙方伺服器的配合才能完成﹐那麼有沒有法子不需要
上游餵進來﹐而主動去抓文章的辦法呢﹖當然有啦﹗用 <B style="color:black;background-color:#ffff66">suck</B> 就可以做到﹐下面就和大
家談談如何用 <B style="color:black;background-color:#ffff66">suck</B> 抓信吧﹐而且還能 post 回去哦~~~

這裡我要特別感謝 lman 兄&lt;lman@ccns.ncku.edu.tw&gt;的大力幫助﹐才讓我的測試順利
完成。有興趣討論 <B style="color:black;background-color:#ffff66">suck</B> 相關技術的朋友也可以找他研究一下的。

當然﹐首先要做的事情是取得 <B style="color:black;background-color:#ffff66">suck</B> 這隻程式﹐我這裡使用的是
<B style="color:black;background-color:#ffff66">suck</B>-4.2.3-1.i386.rpm ﹐從 <a href="http://rpmfind.net/linux/RPM/">http://rpmfind.net/linux/RPM/</a> 那裡抓的。直接用
rpm 安裝就好了﹐根本不用設定一大堆有的沒的﹐如 prefix 之類的東東。

不過﹐在真正動手設定 <B style="color:black;background-color:#ffff66">suck</B> 之前﹐我們首先要修改 innd ﹐以符合這個特殊的環境。
首先﹐您不能像前面教的被動餵信模式那樣保留長長的一列 /var/lib/news/active 記
錄。因為 <B style="color:black;background-color:#ffff66">suck</B> 會依據 /var/lib/<B style="color:black;background-color:#ffff66">suck</B>/sucknewsrc 這個檔案來決定到上游抓信。這本
來沒什麼問題﹐您可以手工的修改它(請參考 man <B style="color:black;background-color:#ffff66">suck</B>)﹐但在我目前使用的這個 rpm
套件版本﹐sucknewsrc 卻會在執行 get.news.inn (後面就會談到) 之後把群組名稱同
步到 active 記錄裡面的名稱。如果您的 active 是滿滿的一大串﹐那麼下次執行
get.news.inn 的時候﹐恐怕會嘗試抓所有的群組信件回來﹐這樣子﹐就算您不計較時
間和頻寬﹐您也得每天至少準備 500MB 的空間(取決於名單長度)來裝那些信件。

這不同正常的被動模式那樣﹕可以通過 newsfeeds 和 incoming.conf 來限制群組名單
哦﹐所以一定要小心設計 active﹐把不必要的群組拿掉。您可以手工刪除﹐也可以動
一下腦筋去修改啦﹐比方我只想留 tw.bbs.comp 和本地的群組﹐我會這樣做﹕
cd /var/lib/news
cat active | grep &quot;tw.bbs.comp&quot; | awk '{ $2 = &quot;0000000000&quot; ; \ $3 =
&quot;0000000001&quot; ; print }' &gt; active.tmp    # 同時完成歸零的動作
cat active.bak &gt; active    # 這是上次抓上游 active 時﹐原來的本機群組備份)
cat active.tmp &gt;&gt; active


另外﹐您還得修改 /etc/news/newsfeeds ﹐為上游定義一個名稱﹐以及把您要回餵的
群組寫進去。您可以參考前面所教的範例﹐不過﹐我現在的例子要用 news1 這個名稱
哦﹗而且每次修改好 innd﹐別忘了讓 innd 重新讀入更新檔案或重新啟動。

等安裝好 <B style="color:black;background-color:#ffff66">suck</B> 之後﹐就進入 /var/lib/<B style="color:black;background-color:#ffff66">suck</B> 這個目錄工作了。您全部要做的只是編
輯一個檔案﹐修改 get.news.inn ﹐主要是下面這幾句就夠了﹕

把您要抓的上游主機寫好﹕
REMOTE_HOST=news1.siyongc.domain

接著寫也給上游起一個名字﹐是用來把信件餵回上去的。要注意﹕這個名稱跟
newsfeeds 裡面所定義的要一至哦﹗
SITE=news1

如果您執行這個 script 沒問題的話﹐應該不用做什麼修改了。但如果您碰到“GROUP
command not recognized, try the -M option”這樣的錯誤信息﹐那您還要修改另外
兩行﹐在句子中插入一個 &quot; -M &quot; 選項﹕
......

    # download messages
    ${<B style="color:black;background-color:#ffff66">SUCK</B>} ${REMOTE_HOST} -M -c -A -bp -hl ${LOCAL_HOST} -dt ${TMPDIR} -dm
${MSGDI
R} -dd ${BASEDIR} -HF ${HISTORY}

......

            # outgoing messages to post
            ${RPOST} ${REMOTE_HOST} -M -d -b ${OUTGOINGNEW} -p
${SPOOLDIR} -f \$
\$o=${OUTFILE} ${SCRIPT} \$\$i ${OUTFILE}

......

接下來的工作﹐就是執行:

./get.news.inn


不過﹐就算您的設定完全沒問題﹐根據我這裡的經驗﹐您還不能抓上游的文章啦。您必
須還要幫 sucknewsrc 做一個歸零的動作﹕

cat sucknewsrc | awk '{ $2 = &quot;1&quot; ; print }' &gt; sucknewsrc


然後再重新執行 get.news.inn 。假如您有時間﹐應該 man <B style="color:black;background-color:#ffff66">suck</B> 看看如何設定這個
sucknewsrc 的﹐這樣您就可以對群組有更大的控制空間了。

測試

假如不牽涉餵信的問題﹐設定一個 NEWS 伺服器是非常簡單的﹐應該不至於有問題出
現。不過﹐會得運用 inncheck -v 來檢查﹐會幫我們找到許多設定問題。不過有些東
西﹐inncheck 也無能為力﹐例如﹐在 active 檔案裡面﹐留意是否要包含原來的那些
群組﹐例如 control､control.cancel､juck 等幾個﹐別以為從上游抓下來的就可以
代替哦。反而﹐newsgroups 那個檔案倒不是很重要﹐只要將群組描述清楚就可以了。

當您完成一些設定之後﹐其實沒有必要一定重新啟動 innd 的。您可以執行
ctlinnd -h 看看有哪些動作可以做﹐比如﹐重新讀取 active 檔﹕

ctlinnd reload active &quot;update active only&quot;

註﹕別少了最後那個 “reason”哦﹐就算您不想打字﹐也應該要有一對 &quot; &quot; 符號。

在做餵信的時候﹐最關鍵是 newsfeeds 那個檔案﹐一定要留意格式是否寫對了﹐以及
傳送模式(如Tf)和寫入信息(如Wnm)是否設對﹐這裡的設定要符合 nntpsend.ctl 的要
求。我強烈建議您 man newsfeeds 看看啦。當然﹐還別忘了受方也要設定好
incoming.conf 哦。

如果您要用 <B style="color:black;background-color:#ffff66">suck</B> 來抓信和送信﹐要注意的地方是 get.news.inn 檔案裡面的 SITE=
要和 newsfeed 裡面設定的名稱一致。因為送信時是主要參考
/var/spool/news/outgoing 目錄下的名稱﹐它必須由 innd 產生﹐而供 <B style="color:black;background-color:#ffff66">suck</B> 來讀
取。要是在 post 過程中遇到問題﹐或許會在該目錄下產生一個 xxxx.new (xxxx 是
site 名稱)﹐這樣會造成往後的文章都不能 post。這時候﹐只要將那些 *.new 砍掉就
是了。

最後﹐如果您想對 NEWS 做更深入的了解﹐可以參閱 &lt;&lt;曾桑談如何架設 News Server
(修正版)&gt;&gt; 這篇文章。(我是從 台大電機 Maxwell BBS 精華區 看來的﹐雖然著作日
期舊了一點﹐但絕對值得一讀﹗)





--
======= http://go.to/study-area =======
飛雪迎春到﹐風雨送春歸
已是寒崖百丈冰﹐尤有花枝俏
俏也不爭春﹐只把春來報
待得山花爛漫時﹐他在叢中笑﹗</pre> <center><p><hr class=z><table width=100% cellpadding=2 cellspacing=0 border=0><tr><td class=t align=center><font size=-1>&nbsp;</font></table><br><font size=-1 class=p>&copy;2003 Google</font></center></body></html>
